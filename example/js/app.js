(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _stormTabAccordion = require('./libs/storm-tab-accordion');

var _stormTabAccordion2 = _interopRequireDefault(_stormTabAccordion);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var onDOMContentLoadedTasks = [function () {
  _stormTabAccordion2.default.init('.js-tab-accordion');
}];

if ('addEventListener' in window) window.addEventListener('DOMContentLoaded', function () {
  onDOMContentLoadedTasks.forEach(function (fn) {
    return fn();
  });
});

},{"./libs/storm-tab-accordion":2}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
/**
 * @name storm-tabs: Multi-panelled content areas 
 * @version 0.6.0: Wed, 09 Nov 2016 18:11:46 GMT
 * @author mjbp
 * @license MIT
 */
var KEY_CODES = {
	SPACE: 32,
	ENTER: 13,
	TAB: 9,
	LEFT: 37,
	RIGHT: 39,
	UP: 38,
	DOWN: 40
},
    defaults = {
	tabClass: '.js-tab-accordion-tab',
	titleClass: '.js-tab-accordion-title',
	currentClass: 'active',
	active: 0,
	tabCursorEvent: 'click'
},
    StormTabAccordion = {
	init: function init() {
		var _this = this;

		var hash = location.hash.slice(1) || null;
		this.tabs = [].slice.call(this.DOMElement.querySelectorAll(this.settings.tabClass));
		this.titles = [].slice.call(this.DOMElement.querySelectorAll(this.settings.titleClass));

		this.targets = this.tabs.map(function (el) {
			return document.getElementById(el.getAttribute('href').substr(1)) || console.error('Tab target not found');
		});

		this.current = this.settings.active;
		if (hash) {
			this.targets.forEach(function (target, i) {
				if (target.getAttribute('id') === hash) {
					_this.current = i;
				}
			});
		}
		this.initAria();
		this.initTitles();
		this.initTabs();
		this.open(this.current);
	},
	initAria: function initAria() {
		this.tabs.forEach(function (el) {
			el.setAttribute('role', 'tab');
			el.setAttribute('tabIndex', 0);
			el.setAttribute('aria-expanded', false);
			el.setAttribute('aria-selected', false);
			el.setAttribute('aria-controls', el.getAttribute('href') ? el.getAttribute('href').substr(1) : el.parentNode.getAttribute('id'));
		});
		this.targets.forEach(function (el) {
			el.setAttribute('role', 'tabpanel');
			el.setAttribute('aria-hidden', true);
			el.setAttribute('tabIndex', '-1');
		});
		return this;
	},
	initTitles: function initTitles() {
		var _this2 = this;

		var handler = function handler(i) {
			_this2.toggle(i);
		};

		this.titles.forEach(function (el, i) {
			el.addEventListener(_this2.settings.tabCursorEvent, function (e) {
				if (!!e.keyCode && e.keyCode === KEY_CODES.TAB) return;

				if (!e.keyCode || e.keyCode === KEY_CODES.ENTER) {
					e.preventDefault();
					handler.call(_this2, i);
				}
			}, false);
		});

		return this;
	},
	initTabs: function initTabs() {
		var _this3 = this;

		var handler = function handler(i) {
			_this3.toggle(i);
		};

		this.lastFocusedTab = 0;

		this.tabs.forEach(function (el, i) {
			//navigate
			el.addEventListener('keydown', function (e) {
				switch (e.keyCode) {
					case KEY_CODES.UP:
						e.preventDefault();
						_this3.toggle(_this3.current === 0 ? _this3.tabs.length - 1 : _this3.current - 1);
						window.setTimeout(function () {
							_this3.tabs[_this3.current].focus();
						}, 16);
						break;
					case KEY_CODES.LEFT:
						_this3.toggle(_this3.current === 0 ? _this3.tabs.length - 1 : _this3.current - 1);
						window.setTimeout(function () {
							_this3.tabs[_this3.current].focus();
						}, 16);
						break;
					case KEY_CODES.DOWN:
						e.preventDefault();
						_this3.toggle(_this3.current === _this3.tabs.length - 1 ? 0 : _this3.current + 1);
						window.setTimeout(function () {
							_this3.tabs[_this3.current].focus();
						}, 16);
						break;
					case KEY_CODES.RIGHT:
						_this3.toggle(_this3.current === _this3.tabs.length - 1 ? 0 : _this3.current + 1);
						window.setTimeout(function () {
							_this3.tabs[_this3.current].focus();
						}, 16);
						break;
					case KEY_CODES.ENTER:
						handler.call(_this3, i);
						window.setTimeout(function () {
							_this3.tabs[i].focus();
						}, 16);
						break;
					case KEY_CODES.SPACE:
						e.preventDefault();
						_this3.toggle(i);
						window.setTimeout(function () {
							_this3.tabs[i].focus();
						}, 16);
						break;
					case KEY_CODES.TAB:
						e.preventDefault();
						e.stopPropagation();
						_this3.lastFocusedTab = _this3.getTabIndex(e.target);
						_this3.setTargetFocus(_this3.lastFocusedTab);
						handler.call(_this3, i);
						break;
					default:
						//
						break;
				}
			});

			//toggle
			el.addEventListener('click', function (e) {
				e.preventDefault();
				handler.call(_this3, i);
			}, false);
		});

		return this;
	},
	getTabIndex: function getTabIndex(link) {
		for (var i = 0; i < this.tabs.length; i++) {
			if (link === this.tabs[i]) return i;
		}
		return null;
	},
	getFocusableChildren: function getFocusableChildren(node) {
		var focusableElements = ['a[href]', 'area[href]', 'input:not([disabled])', 'select:not([disabled])', 'textarea:not([disabled])', 'button:not([disabled])', 'iframe', 'object', 'embed', '[contenteditable]', '[tabIndex]:not([tabIndex="-1"])'];
		return [].slice.call(node.querySelectorAll(focusableElements.join(',')));
	},
	setTargetFocus: function setTargetFocus(tabIndex) {
		this.focusableChildren = this.getFocusableChildren(this.targets[tabIndex]);

		if (this.focusableChildren.length) {
			window.setTimeout(function () {
				this.focusableChildren[0].focus();
				this.keyEventListener = this.keyListener.bind(this);
				document.addEventListener('keydown', this.keyEventListener);
			}.bind(this), 0);
		}
	},
	keyListener: function keyListener(e) {
		if (e.keyCode !== KEY_CODES.TAB) return;

		var focusedIndex = this.focusableChildren.indexOf(document.activeElement);

		if (focusedIndex < 0) {
			document.removeEventListener('keydown', this.keyEventListener);
			return;
		}

		if (e.shiftKey && focusedIndex === 0) {
			e.preventDefault();
			this.focusableChildren[this.focusableChildren.length - 1].focus();
		} else {
			if (!e.shiftKey && focusedIndex === this.focusableChildren.length - 1) {
				document.removeEventListener('keydown', this.keyEventListener);
				if (this.lastFocusedTab !== this.tabs.length - 1) {
					e.preventDefault();
					this.lastFocusedTab = this.lastFocusedTab + 1;
					this.tabs[this.lastFocusedTab].focus();
				}
			}
		}
	},
	change: function change(type, i) {
		var methods = {
			open: {
				classlist: 'add',
				tabIndex: {
					target: this.targets[i],
					value: '0'
				}
			},
			close: {
				classlist: 'remove',
				tabIndex: {
					target: this.targets[this.current],
					value: '-1'
				}
			}
		};

		this.tabs[i].classList[methods[type].classlist](this.settings.currentClass);
		this.titles[i].classList[methods[type].classlist](this.settings.currentClass);
		this.targets[i].classList[methods[type].classlist](this.settings.currentClass);

		this.targets[i].setAttribute('aria-hidden', !this.targets[i].getAttribute('aria-hidden'));
		this.tabs[i].setAttribute('aria-selected', !this.targets[i].getAttribute('aria-selected'));
		this.tabs[i].setAttribute('aria-expanded', !this.targets[i].getAttribute('aria-expanded'));
		methods[type].tabIndex.target.setAttribute('tabIndex', methods[type].tabIndex.value);
	},
	open: function open(i) {
		this.change('open', i);
		this.current = i;
		return this;
	},
	close: function close(i) {
		this.change('close', i);
		return this;
	},
	toggle: function toggle(i) {
		if (this.current === i) {
			return;
		}

		!!window.history.pushState && window.history.pushState({ URL: this.tabs[i].getAttribute('href') }, '', this.tabs[i].getAttribute('href'));
		if (this.current === null) {
			this.open(i);
			return this;
		}
		this.close(this.current).open(i);
		return this;
	}
};

var init = function init(sel, opts) {
	var els = [].slice.call(document.querySelectorAll(sel));

	if (!els.length) throw new Error('Tab Accordion cannot be initialised, no augmentable elements found');

	return els.map(function (el) {
		return Object.assign(Object.create(StormTabAccordion), {
			DOMElement: el,
			settings: Object.assign({}, defaults, opts)
		}).init();
	});
};

exports.default = { init: init };

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJleGFtcGxlL3NyYy9hcHAuanMiLCJleGFtcGxlL3NyYy9saWJzL3N0b3JtLXRhYi1hY2NvcmRpb24uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBOzs7Ozs7QUFFQSxJQUFNLDBCQUEwQixDQUFDLFlBQU07QUFDdEMsOEJBQWEsSUFBYixDQUFrQixtQkFBbEI7QUFDQSxDQUYrQixDQUFoQzs7QUFJQSxJQUFHLHNCQUFzQixNQUF6QixFQUFpQyxPQUFPLGdCQUFQLENBQXdCLGtCQUF4QixFQUE0QyxZQUFNO0FBQUUsMEJBQXdCLE9BQXhCLENBQWdDLFVBQUMsRUFBRDtBQUFBLFdBQVEsSUFBUjtBQUFBLEdBQWhDO0FBQWdELENBQXBHOzs7Ozs7OztBQ05qQzs7Ozs7O0FBTUEsSUFBTSxZQUFZO0FBQ2hCLFFBQU8sRUFEUztBQUVoQixRQUFPLEVBRlM7QUFHaEIsTUFBSyxDQUhXO0FBSWhCLE9BQU0sRUFKVTtBQUtoQixRQUFPLEVBTFM7QUFNaEIsS0FBRyxFQU5hO0FBT2hCLE9BQU07QUFQVSxDQUFsQjtBQUFBLElBU0MsV0FBVztBQUNWLFdBQVUsdUJBREE7QUFFVixhQUFZLHlCQUZGO0FBR1YsZUFBYyxRQUhKO0FBSVYsU0FBUSxDQUpFO0FBS1YsaUJBQWdCO0FBTE4sQ0FUWjtBQUFBLElBZ0JDLG9CQUFvQjtBQUNuQixLQURtQixrQkFDWjtBQUFBOztBQUNOLE1BQUksT0FBTyxTQUFTLElBQVQsQ0FBYyxLQUFkLENBQW9CLENBQXBCLEtBQTBCLElBQXJDO0FBQ0EsT0FBSyxJQUFMLEdBQVksR0FBRyxLQUFILENBQVMsSUFBVCxDQUFjLEtBQUssVUFBTCxDQUFnQixnQkFBaEIsQ0FBaUMsS0FBSyxRQUFMLENBQWMsUUFBL0MsQ0FBZCxDQUFaO0FBQ0EsT0FBSyxNQUFMLEdBQWMsR0FBRyxLQUFILENBQVMsSUFBVCxDQUFjLEtBQUssVUFBTCxDQUFnQixnQkFB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LENBQVAsRUFBekIsRUFBcUUsRUFBckUsRUFBeUUsS0FBSyxJQUFMLENBQVUsQ0FBVixFQUFhLFlBQWIsQ0FBMEIsTUFBMUIsQ0FBekUsQ0FBOUI7QUFDQSxNQUFHLEtBQUssT0FBTCxLQUFpQixJQUFwQixFQUEwQjtBQUN6QixRQUFLLElBQUwsQ0FBVSxDQUFWO0FBQ0EsVUFBTyxJQUFQO0FBQ0E7QUFDRCxPQUFLLEtBQUwsQ0FBVyxLQUFLLE9BQWhCLEVBQ0UsSUFERixDQUNPLENBRFA7QUFFQSxTQUFPLElBQVA7QUFDQTtBQW5Oa0IsQ0FoQnJCOztBQXNPQSxJQUFNLE9BQU8sU0FBUCxJQUFPLENBQUMsR0FBRCxFQUFNLElBQU4sRUFBZTtBQUMzQixLQUFJLE1BQU0sR0FBRyxLQUFILENBQVMsSUFBVCxDQUFjLFNBQVMsZ0JBQVQsQ0FBMEIsR0FBMUIsQ0FBZCxDQUFWOztBQUVBLEtBQUcsQ0FBQyxJQUFJLE1BQVIsRUFBZ0IsTUFBTSxJQUFJLEtBQUosQ0FBVSxvRUFBVixDQUFOOztBQUVoQixRQUFPLElBQUksR0FBSixDQUFRLFVBQUMsRUFBRCxFQUFRO0FBQ3RCLFNBQU8sT0FBTyxNQUFQLENBQWMsT0FBTyxNQUFQLENBQWMsaUJBQWQsQ0FBZCxFQUFnRDtBQUN0RCxlQUFZLEVBRDBDO0FBRXRELGFBQVUsT0FBTyxNQUFQLENBQWMsRUFBZCxFQUFrQixRQUFsQixFQUE0QixJQUE1QjtBQUY0QyxHQUFoRCxFQUdKLElBSEksRUFBUDtBQUlBLEVBTE0sQ0FBUDtBQU1BLENBWEQ7O2tCQWFlLEVBQUUsVUFBRixFIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImltcG9ydCBUYWJBY2NvcmRpb24gZnJvbSAnLi9saWJzL3N0b3JtLXRhYi1hY2NvcmRpb24nO1xuXG5jb25zdCBvbkRPTUNvbnRlbnRMb2FkZWRUYXNrcyA9IFsoKSA9PiB7XG5cdFRhYkFjY29yZGlvbi5pbml0KCcuanMtdGFiLWFjY29yZGlvbicpO1xufV07XG4gICAgXG5pZignYWRkRXZlbnRMaXN0ZW5lcicgaW4gd2luZG93KSB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsgb25ET01Db250ZW50TG9hZGVkVGFza3MuZm9yRWFjaCgoZm4pID0+IGZuKCkpOyB9KTsiLCIvKipcbiAqIEBuYW1lIHN0b3JtLXRhYnM6IE11bHRpLXBhbmVsbGVkIGNvbnRlbnQgYXJlYXMgXG4gKiBAdmVyc2lvbiAwLjYuMDogV2VkLCAwOSBOb3YgMjAxNiAxODoxMTo0NiBHTVRcbiAqIEBhdXRob3IgbWpicFxuICogQGxpY2Vuc2UgTUlUXG4gKi9cbmNvbnN0IEtFWV9DT0RFUyA9IHtcblx0XHRTUEFDRTogMzIsXG5cdFx0RU5URVI6IDEzLFxuXHRcdFRBQjogOSxcblx0XHRMRUZUOiAzNyxcblx0XHRSSUdIVDogMzksXG5cdFx0VVA6MzgsXG5cdFx0RE9XTjogNDBcblx0fSxcblx0ZGVmYXVsdHMgPSB7XG5cdFx0dGFiQ2xhc3M6ICcuanMtdGFiLWFjY29yZGlvbi10YWInLFxuXHRcdHRpdGxlQ2xhc3M6ICcuanMtdGFiLWFjY29yZGlvbi10aXRsZScsXG5cdFx0Y3VycmVudENsYXNzOiAnYWN0aXZlJyxcblx0XHRhY3RpdmU6IDAsXG5cdFx0dGFiQ3Vyc29yRXZlbnQ6ICdjbGljaydcblx0fSxcblx0U3Rvcm1UYWJBY2NvcmRpb24gPSB7XG5cdFx0aW5pdCgpIHtcblx0XHRcdGxldCBoYXNoID0gbG9jYXRpb24uaGFzaC5zbGljZSgxKSB8fCBudWxsO1xuXHRcdFx0dGhpcy50YWJzID0gW10uc2xpY2UuY2FsbCh0aGlzLkRPTUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLnNldHRpbmdzLnRhYkNsYXNzKSk7XG5cdFx0XHR0aGlzLnRpdGxlcyA9IFtdLnNsaWNlLmNhbGwodGhpcy5ET01FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5zZXR0aW5ncy50aXRsZUNsYXNzKSk7XG5cblx0XHRcdHRoaXMudGFyZ2V0cyA9IHRoaXMudGFicy5tYXAoZWwgPT4ge1xuXHRcdFx0XHRyZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWwuZ2V0QXR0cmlidXRlKCdocmVmJykuc3Vic3RyKDEpKSB8fCBjb25zb2xlLmVycm9yKCdUYWIgdGFyZ2V0IG5vdCBmb3VuZCcpO1xuXHRcdFx0fSk7XG5cdFx0XHRcdFxuXHRcdFx0dGhpcy5jdXJyZW50ID0gdGhpcy5zZXR0aW5ncy5hY3RpdmU7XG5cdFx0XHRpZiAoaGFzaCkge1xuXHRcdFx0XHR0aGlzLnRhcmdldHMuZm9yRWFjaCgodGFyZ2V0LCBpKSA9PiB7XG5cdFx0XHRcdFx0aWYgKHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2lkJykgPT09IGhhc2gpIHtcblx0XHRcdFx0XHRcdHRoaXMuY3VycmVudCA9IGk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdHRoaXMuaW5pdEFyaWEoKTtcblx0XHRcdHRoaXMuaW5pdFRpdGxlcygpO1xuXHRcdFx0dGhpcy5pbml0VGFicygpO1xuXHRcdFx0dGhpcy5vcGVuKHRoaXMuY3VycmVudCk7XG5cdFx0fSxcblx0XHRpbml0QXJpYSgpIHtcblx0XHRcdHRoaXMudGFicy5mb3JFYWNoKGVsID0+IHtcblx0XHRcdFx0ZWwuc2V0QXR0cmlidXRlKCdyb2xlJywgJ3RhYicpO1xuXHRcdFx0XHRlbC5zZXRBdHRyaWJ1dGUoJ3RhYkluZGV4JywgMCk7XG5cdFx0XHRcdGVsLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsIGZhbHNlKTtcblx0XHRcdFx0ZWwuc2V0QXR0cmlidXRlKCdhcmlhLXNlbGVjdGVkJywgZmFsc2UpO1xuXHRcdFx0XHRlbC5zZXRBdHRyaWJ1dGUoJ2FyaWEtY29udHJvbHMnLCBlbC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSA/IGVsLmdldEF0dHJpYnV0ZSgnaHJlZicpLnN1YnN0cigxKSA6IGVsLnBhcmVudE5vZGUuZ2V0QXR0cmlidXRlKCdpZCcpKTtcblxuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLnRhcmdldHMuZm9yRWFjaChlbCA9PiB7XG5cdFx0XHRcdGVsLnNldEF0dHJpYnV0ZSgncm9sZScsICd0YWJwYW5lbCcpO1xuXHRcdFx0XHRlbC5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgdHJ1ZSk7XG5cdFx0XHRcdGVsLnNldEF0dHJpYnV0ZSgndGFiSW5kZXgnLCAnLTEnKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRpbml0VGl0bGVzKCkge1xuXHRcdFx0bGV0IGhhbmRsZXIgPSBpID0+IHtcblx0XHRcdFx0dGhpcy50b2dnbGUoaSk7XG5cdFx0XHR9O1xuXG5cdFx0XHR0aGlzLnRpdGxlcy5mb3JFYWNoKChlbCwgaSkgPT4ge1xuXHRcdFx0XHRlbC5hZGRFdmVudExpc3RlbmVyKHRoaXMuc2V0dGluZ3MudGFiQ3Vyc29yRXZlbnQsIGUgPT4ge1xuXHRcdFx0XHRcdGlmKCEhZS5rZXlDb2RlICYmIGUua2V5Q29kZSA9PT0gS0VZX0NPREVTLlRBQikgcmV0dXJuO1xuXG5cdFx0XHRcdFx0aWYoIWUua2V5Q29kZSB8fCBlLmtleUNvZGUgPT09IEtFWV9DT0RFUy5FTlRFUil7XG5cdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRoYW5kbGVyLmNhbGwodGhpcywgaSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LCBmYWxzZSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRpbml0VGFicygpIHtcblx0XHRcdGxldCBoYW5kbGVyID0gaSA9PiB7XG5cdFx0XHRcdHRoaXMudG9nZ2xlKGkpO1xuXHRcdFx0fTtcblxuXHRcdFx0dGhpcy5sYXN0Rm9jdXNlZFRhYiA9IDA7XG5cblx0XHRcdHRoaXMudGFicy5mb3JFYWNoKChlbCwgaSkgPT4ge1xuXHRcdFx0XHQvL25hdmlnYXRlXG5cdFx0XHRcdGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBlID0+IHtcblx0XHRcdFx0XHRzd2l0Y2ggKGUua2V5Q29kZSkge1xuXHRcdFx0XHRcdGNhc2UgS0VZX0NPREVTLlVQOlxuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0dGhpcy50b2dnbGUoKHRoaXMuY3VycmVudCA9PT0gMCA/IHRoaXMudGFicy5sZW5ndGggLSAxIDogdGhpcy5jdXJyZW50IC0gMSkpO1xuXHRcdFx0XHRcdFx0d2luZG93LnNldFRpbWVvdXQoKCkgPT4geyB0aGlzLnRhYnNbdGhpcy5jdXJyZW50XS5mb2N1cygpOyB9LCAxNik7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlIEtFWV9DT0RFUy5MRUZUOlxuXHRcdFx0XHRcdFx0dGhpcy50b2dnbGUoKHRoaXMuY3VycmVudCA9PT0gMCA/IHRoaXMudGFicy5sZW5ndGggLSAxIDogdGhpcy5jdXJyZW50IC0gMSkpO1xuXHRcdFx0XHRcdFx0d2luZG93LnNldFRpbWVvdXQoKCkgPT4geyB0aGlzLnRhYnNbdGhpcy5jdXJyZW50XS5mb2N1cygpOyB9LCAxNik7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlIEtFWV9DT0RFUy5ET1dOOlxuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0dGhpcy50b2dnbGUoKHRoaXMuY3VycmVudCA9PT0gdGhpcy50YWJzLmxlbmd0aCAtIDEgPyAwIDogdGhpcy5jdXJyZW50ICsgMSkpO1xuXHRcdFx0XHRcdFx0d2luZG93LnNldFRpbWVvdXQoKCkgPT4geyB0aGlzLnRhYnNbdGhpcy5jdXJyZW50XS5mb2N1cygpOyB9LCAxNik7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlIEtFWV9DT0RFUy5SSUdIVDpcblx0XHRcdFx0XHRcdHRoaXMudG9nZ2xlKCh0aGlzLmN1cnJlbnQgPT09IHRoaXMudGFicy5sZW5ndGggLSAxID8gMCA6IHRoaXMuY3VycmVudCArIDEpKTtcblx0XHRcdFx0XHRcdHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHsgdGhpcy50YWJzW3RoaXMuY3VycmVudF0uZm9jdXMoKTsgfSwgMTYpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0Y2FzZSBLRVlfQ09ERVMuRU5URVI6XG5cdFx0XHRcdFx0XHRoYW5kbGVyLmNhbGwodGhpcywgaSk7ICBcblx0XHRcdFx0XHRcdHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHsgdGhpcy50YWJzW2ldLmZvY3VzKCk7IH0sIDE2KTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdGNhc2UgS0VZX0NPREVTLlNQQUNFOlxuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0dGhpcy50b2dnbGUoaSk7XG5cdFx0XHRcdFx0XHR3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7IHRoaXMudGFic1tpXS5mb2N1cygpOyB9LCAxNik7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlIEtFWV9DT0RFUy5UQUI6XG5cdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0dGhpcy5sYXN0Rm9jdXNlZFRhYiA9IHRoaXMuZ2V0VGFiSW5kZXgoZS50YXJnZXQpO1xuXHRcdFx0XHRcdFx0dGhpcy5zZXRUYXJnZXRGb2N1cyh0aGlzLmxhc3RGb2N1c2VkVGFiKTtcblx0XHRcdFx0XHRcdGhhbmRsZXIuY2FsbCh0aGlzLCBpKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHRcdC8vXG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdC8vdG9nZ2xlXG5cdFx0XHRcdGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdGhhbmRsZXIuY2FsbCh0aGlzLCBpKTsgIFxuXHRcdFx0XHR9LCBmYWxzZSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRnZXRUYWJJbmRleChsaW5rKXtcblx0XHRcdGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLnRhYnMubGVuZ3RoOyBpKyspe1xuXHRcdFx0XHRpZihsaW5rID09PSB0aGlzLnRhYnNbaV0pIHJldHVybiBpO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSxcblx0XHRnZXRGb2N1c2FibGVDaGlsZHJlbihub2RlKSB7XG5cdFx0XHRsZXQgZm9jdXNhYmxlRWxlbWVudHMgPSBbJ2FbaHJlZl0nLCAnYXJlYVtocmVmXScsICdpbnB1dDpub3QoW2Rpc2FibGVkXSknLCAnc2VsZWN0Om5vdChbZGlzYWJsZWRdKScsICd0ZXh0YXJlYTpub3QoW2Rpc2FibGVkXSknLCAnYnV0dG9uOm5vdChbZGlzYWJsZWRdKScsICdpZnJhbWUnLCAnb2JqZWN0JywgJ2VtYmVkJywgJ1tjb250ZW50ZWRpdGFibGVdJywgJ1t0YWJJbmRleF06bm90KFt0YWJJbmRleD1cIi0xXCJdKSddO1xuXHRcdFx0cmV0dXJuIFtdLnNsaWNlLmNhbGwobm9kZS5xdWVyeVNlbGVjdG9yQWxsKGZvY3VzYWJsZUVsZW1lbnRzLmpvaW4oJywnKSkpO1xuXHRcdH0sXG5cdFx0c2V0VGFyZ2V0Rm9jdXModGFiSW5kZXgpe1xuXHRcdFx0dGhpcy5mb2N1c2FibGVDaGlsZHJlbiA9IHRoaXMuZ2V0Rm9jdXNhYmxlQ2hpbGRyZW4odGhpcy50YXJnZXRzW3RhYkluZGV4XSk7XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMuZm9jdXNhYmxlQ2hpbGRyZW4ubGVuZ3RoKXtcblx0XHRcdFx0d2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKXtcblx0XHRcdFx0XHR0aGlzLmZvY3VzYWJsZUNoaWxkcmVuWzBdLmZvY3VzKCk7XG5cdFx0XHRcdFx0dGhpcy5rZXlFdmVudExpc3RlbmVyID0gdGhpcy5rZXlMaXN0ZW5lci5iaW5kKHRoaXMpO1xuXHRcdFx0XHRcdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmtleUV2ZW50TGlzdGVuZXIpO1xuXHRcdFx0XHR9LmJpbmQodGhpcyksIDApO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0a2V5TGlzdGVuZXIoZSl7XG5cdFx0XHRpZiAoZS5rZXlDb2RlICE9PSBLRVlfQ09ERVMuVEFCKSByZXR1cm47XG5cdFx0XHRcblx0XHRcdGxldCBmb2N1c2VkSW5kZXggPSB0aGlzLmZvY3VzYWJsZUNoaWxkcmVuLmluZGV4T2YoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCk7XG5cdFx0XHRcblx0XHRcdGlmKGZvY3VzZWRJbmRleCA8IDApIHtcblx0XHRcdFx0ZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMua2V5RXZlbnRMaXN0ZW5lcik7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYoZS5zaGlmdEtleSAmJiBmb2N1c2VkSW5kZXggPT09IDApIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR0aGlzLmZvY3VzYWJsZUNoaWxkcmVuW3RoaXMuZm9jdXNhYmxlQ2hpbGRyZW4ubGVuZ3RoIC0gMV0uZm9jdXMoKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmKCFlLnNoaWZ0S2V5ICYmIGZvY3VzZWRJbmRleCA9PT0gdGhpcy5mb2N1c2FibGVDaGlsZHJlbi5sZW5ndGggLSAxKSB7XG5cdFx0XHRcdFx0ZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMua2V5RXZlbnRMaXN0ZW5lcik7XG5cdFx0XHRcdFx0aWYodGhpcy5sYXN0Rm9jdXNlZFRhYiAhPT0gdGhpcy50YWJzLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdHRoaXMubGFzdEZvY3VzZWRUYWIgPSB0aGlzLmxhc3RGb2N1c2VkVGFiICsgMTtcblx0XHRcdFx0XHRcdHRoaXMudGFic1t0aGlzLmxhc3RGb2N1c2VkVGFiXS5mb2N1cygpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cdFx0Y2hhbmdlKHR5cGUsIGkpIHtcblx0XHRcdGxldCBtZXRob2RzID0ge1xuXHRcdFx0XHRvcGVuOiB7XG5cdFx0XHRcdFx0Y2xhc3NsaXN0OiAnYWRkJyxcblx0XHRcdFx0XHR0YWJJbmRleDoge1xuXHRcdFx0XHRcdFx0dGFyZ2V0OiB0aGlzLnRhcmdldHNbaV0sXG5cdFx0XHRcdFx0XHR2YWx1ZTogJzAnXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LFxuXHRcdFx0XHRjbG9zZToge1xuXHRcdFx0XHRcdGNsYXNzbGlzdDogJ3JlbW92ZScsXG5cdFx0XHRcdFx0dGFiSW5kZXg6IHtcblx0XHRcdFx0XHRcdHRhcmdldDogdGhpcy50YXJnZXRzW3RoaXMuY3VycmVudF0sXG5cdFx0XHRcdFx0XHR2YWx1ZTogJy0xJ1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fTtcblxuXHRcdFx0dGhpcy50YWJzW2ldLmNsYXNzTGlzdFttZXRob2RzW3R5cGVdLmNsYXNzbGlzdF0odGhpcy5zZXR0aW5ncy5jdXJyZW50Q2xhc3MpO1xuXHRcdFx0dGhpcy50aXRsZXNbaV0uY2xhc3NMaXN0W21ldGhvZHNbdHlwZV0uY2xhc3NsaXN0XSh0aGlzLnNldHRpbmdzLmN1cnJlbnRDbGFzcyk7XG5cdFx0XHR0aGlzLnRhcmdldHNbaV0uY2xhc3NMaXN0W21ldGhvZHNbdHlwZV0uY2xhc3NsaXN0XSh0aGlzLnNldHRpbmdzLmN1cnJlbnRDbGFzcyk7XG5cblx0XHRcdHRoaXMudGFyZ2V0c1tpXS5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgIXRoaXMudGFyZ2V0c1tpXS5nZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJykpO1xuXHRcdFx0dGhpcy50YWJzW2ldLnNldEF0dHJpYnV0ZSgnYXJpYS1zZWxlY3RlZCcsICF0aGlzLnRhcmdldHNbaV0uZ2V0QXR0cmlidXRlKCdhcmlhLXNlbGVjdGVkJykpO1xuXHRcdFx0dGhpcy50YWJzW2ldLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsICF0aGlzLnRhcmdldHNbaV0uZ2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJykpO1xuXHRcdFx0bWV0aG9kc1t0eXBlXS50YWJJbmRleC50YXJnZXQuc2V0QXR0cmlidXRlKCd0YWJJbmRleCcsIG1ldGhvZHNbdHlwZV0udGFiSW5kZXgudmFsdWUpO1xuXHRcdFx0XG5cdFx0fSxcblx0XHRvcGVuKGkpIHtcblx0XHRcdHRoaXMuY2hhbmdlKCdvcGVuJywgaSk7XG5cdFx0XHR0aGlzLmN1cnJlbnQgPSBpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRjbG9zZShpKSB7XG5cdFx0XHR0aGlzLmNoYW5nZSgnY2xvc2UnLCBpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0dG9nZ2xlKGkpIHtcblx0XHRcdGlmKHRoaXMuY3VycmVudCA9PT0gaSkgeyByZXR1cm47IH1cblx0XHRcdFxuXHRcdFx0ISF3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUgJiYgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKHsgVVJMOiB0aGlzLnRhYnNbaV0uZ2V0QXR0cmlidXRlKCdocmVmJykgfSwgJycsIHRoaXMudGFic1tpXS5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSk7XG5cdFx0XHRpZih0aGlzLmN1cnJlbnQgPT09IG51bGwpIHsgXG5cdFx0XHRcdHRoaXMub3BlbihpKTtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLmNsb3NlKHRoaXMuY3VycmVudClcblx0XHRcdFx0Lm9wZW4oaSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cdH07XG5cbmNvbnN0IGluaXQgPSAoc2VsLCBvcHRzKSA9PiB7XG5cdGxldCBlbHMgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsKSk7XG5cdFxuXHRpZighZWxzLmxlbmd0aCkgdGhyb3cgbmV3IEVycm9yKCdUYWIgQWNjb3JkaW9uIGNhbm5vdCBiZSBpbml0aWFsaXNlZCwgbm8gYXVnbWVudGFibGUgZWxlbWVudHMgZm91bmQnKTtcblxuXHRyZXR1cm4gZWxzLm1hcCgoZWwpID0+IHtcblx0XHRyZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuY3JlYXRlKFN0b3JtVGFiQWNjb3JkaW9uKSwge1xuXHRcdFx0RE9NRWxlbWVudDogZWwsXG5cdFx0XHRzZXR0aW5nczogT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdHMsIG9wdHMpXG5cdFx0fSkuaW5pdCgpO1xuXHR9KTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHsgaW5pdCB9OyJdfQ==
