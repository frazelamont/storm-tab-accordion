(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _stormTabAccordion = require('./libs/storm-tab-accordion');

var _stormTabAccordion2 = _interopRequireDefault(_stormTabAccordion);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var onDOMContentLoadedTasks = [function () {
  _stormTabAccordion2.default.init('.js-tab-accordion');
}];

if ('addEventListener' in window) window.addEventListener('DOMContentLoaded', function () {
  onDOMContentLoadedTasks.forEach(function (fn) {
    return fn();
  });
});

},{"./libs/storm-tab-accordion":2}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
/**
 * @name storm-tab-accordion: Tab and accordion ui component for multi-panelled content areas
<<<<<<< HEAD
 * @version 0.5.0: Fri, 10 Feb 2017 17:52:56 GMT
=======
 * @version 0.5.0: Tue, 28 Feb 2017 22:17:09 GMT
>>>>>>> 218e11ecf062432bec6e2b5f53c8bea4b7b299b6
 * @author mjbp
 * @license MIT
 */
var KEY_CODES = {
	SPACE: 32,
	ENTER: 13,
	TAB: 9,
	LEFT: 37,
	RIGHT: 39,
	UP: 38,
	DOWN: 40
},
    defaults = {
	tabClass: '.js-tab-accordion-tab',
	titleClass: '.js-tab-accordion-title',
	currentClass: 'active',
	active: 0,
	tabCursorEvent: 'click'
},
    StormTabAccordion = {
	init: function init() {
		var _this = this;

		var hash = location.hash.slice(1) || null;
		this.tabs = [].slice.call(this.DOMElement.querySelectorAll(this.settings.tabClass));
		this.titles = [].slice.call(this.DOMElement.querySelectorAll(this.settings.titleClass));

		this.targets = this.tabs.map(function (el) {
			return document.getElementById(el.getAttribute('href').substr(1)) || console.error('Tab target not found');
		});

		this.current = this.settings.active;
		if (hash) {
			this.targets.forEach(function (target, i) {
				if (target.getAttribute('id') === hash) {
					_this.current = i;
				}
			});
		}
		this.initAria();
		this.initTitles();
		this.initTabs();
		this.open(this.current);

		return this;
	},
	initAria: function initAria() {
		this.tabs.forEach(function (el) {
			el.setAttribute('role', 'tab');
			el.setAttribute('tabIndex', 0);
			el.setAttribute('aria-expanded', false);
			el.setAttribute('aria-selected', false);
			el.setAttribute('aria-controls', el.getAttribute('href') ? el.getAttribute('href').substr(1) : el.parentNode.getAttribute('id'));
		});
		this.targets.forEach(function (el) {
			el.setAttribute('role', 'tabpanel');
			el.setAttribute('aria-hidden', true);
			el.setAttribute('tabIndex', '-1');
		});
		return this;
	},
	initTitles: function initTitles() {
		var _this2 = this;

		var handler = function handler(i) {
			_this2.toggle(i);
		};

		this.titles.forEach(function (el, i) {
			el.addEventListener(_this2.settings.tabCursorEvent, function (e) {
				if (!!e.keyCode && e.keyCode === KEY_CODES.TAB) return;

				if (!e.keyCode || e.keyCode === KEY_CODES.ENTER) {
					e.preventDefault();
					handler.call(_this2, i);
				}
			}, false);
		});

		return this;
	},
	initTabs: function initTabs() {
		var _this3 = this;

		var handler = function handler(i) {
			_this3.toggle(i);
		};

		this.lastFocusedTab = 0;

		this.tabs.forEach(function (el, i) {
			//navigate
			el.addEventListener('keydown', function (e) {
				switch (e.keyCode) {
					case KEY_CODES.UP:
						e.preventDefault();
						_this3.toggle(_this3.current === 0 ? _this3.tabs.length - 1 : _this3.current - 1);
						window.setTimeout(function () {
							_this3.tabs[_this3.current].focus();
						}, 16);
						break;
					case KEY_CODES.LEFT:
						_this3.toggle(_this3.current === 0 ? _this3.tabs.length - 1 : _this3.current - 1);
						window.setTimeout(function () {
							_this3.tabs[_this3.current].focus();
						}, 16);
						break;
					case KEY_CODES.DOWN:
						e.preventDefault();
						_this3.toggle(_this3.current === _this3.tabs.length - 1 ? 0 : _this3.current + 1);
						window.setTimeout(function () {
							_this3.tabs[_this3.current].focus();
						}, 16);
						break;
					case KEY_CODES.RIGHT:
						_this3.toggle(_this3.current === _this3.tabs.length - 1 ? 0 : _this3.current + 1);
						window.setTimeout(function () {
							_this3.tabs[_this3.current].focus();
						}, 16);
						break;
					case KEY_CODES.ENTER:
						handler.call(_this3, i);
						window.setTimeout(function () {
							_this3.tabs[i].focus();
						}, 16);
						break;
					case KEY_CODES.SPACE:
						e.preventDefault();
						_this3.toggle(i);
						window.setTimeout(function () {
							_this3.tabs[i].focus();
						}, 16);
						break;
					case KEY_CODES.TAB:
						e.preventDefault();
						e.stopPropagation();
						_this3.lastFocusedTab = _this3.getTabIndex(e.target);
						_this3.setTargetFocus(_this3.lastFocusedTab);
						handler.call(_this3, i);
						break;
					default:
						//
						break;
				}
			});

			//toggle
			el.addEventListener('click', function (e) {
				e.preventDefault();
				handler.call(_this3, i);
			}, false);
		});

		return this;
	},
	getTabIndex: function getTabIndex(link) {
		for (var i = 0; i < this.tabs.length; i++) {
			if (link === this.tabs[i]) return i;
		}
		return null;
	},
	getFocusableChildren: function getFocusableChildren(node) {
		var focusableElements = ['a[href]', 'area[href]', 'input:not([disabled])', 'select:not([disabled])', 'textarea:not([disabled])', 'button:not([disabled])', 'iframe', 'object', 'embed', '[contenteditable]', '[tabIndex]:not([tabIndex="-1"])'];
		return [].slice.call(node.querySelectorAll(focusableElements.join(',')));
	},
	setTargetFocus: function setTargetFocus(tabIndex) {
		this.focusableChildren = this.getFocusableChildren(this.targets[tabIndex]);

		if (this.focusableChildren.length) {
			window.setTimeout(function () {
				this.focusableChildren[0].focus();
				this.keyEventListener = this.keyListener.bind(this);
				document.addEventListener('keydown', this.keyEventListener);
			}.bind(this), 0);
		}
	},
	keyListener: function keyListener(e) {
		if (e.keyCode !== KEY_CODES.TAB) return;

		var focusedIndex = this.focusableChildren.indexOf(document.activeElement);

		if (focusedIndex < 0) {
			document.removeEventListener('keydown', this.keyEventListener);
			return;
		}

		if (e.shiftKey && focusedIndex === 0) {
			e.preventDefault();
			this.focusableChildren[this.focusableChildren.length - 1].focus();
		} else {
			if (!e.shiftKey && focusedIndex === this.focusableChildren.length - 1) {
				document.removeEventListener('keydown', this.keyEventListener);
				if (this.lastFocusedTab !== this.tabs.length - 1) {
					e.preventDefault();
					this.lastFocusedTab = this.lastFocusedTab + 1;
					this.tabs[this.lastFocusedTab].focus();
				}
			}
		}
	},
	change: function change(type, i) {
		var methods = {
			open: {
				classlist: 'add',
				tabIndex: {
					target: this.targets[i],
					value: '0'
				}
			},
			close: {
				classlist: 'remove',
				tabIndex: {
					target: this.targets[this.current],
					value: '-1'
				}
			}
		};

		this.tabs[i].classList[methods[type].classlist](this.settings.currentClass);
		this.titles[i].classList[methods[type].classlist](this.settings.currentClass);
		this.targets[i].classList[methods[type].classlist](this.settings.currentClass);

		this.targets[i].setAttribute('aria-hidden', this.targets[i].getAttribute('aria-hidden') === 'true' ? 'false' : 'true');
		this.tabs[i].setAttribute('aria-selected', this.tabs[i].getAttribute('aria-selected') === 'true' ? 'false' : 'true');
		this.tabs[i].setAttribute('aria-expanded', this.tabs[i].getAttribute('aria-expanded') === 'true' ? 'false' : 'true');
		methods[type].tabIndex.target.setAttribute('tabIndex', methods[type].tabIndex.value);
	},
	open: function open(i) {
		this.change('open', i);
		this.current = i;
		return this;
	},
	close: function close(i) {
		this.change('close', i);
		return this;
	},
	toggle: function toggle(i) {
		if (this.current === i) {
			return;
		}

		!!window.history.pushState && window.history.pushState({ URL: this.tabs[i].getAttribute('href') }, '', this.tabs[i].getAttribute('href'));
		if (this.current === null) {
			this.open(i);
			return this;
		}
		this.close(this.current).open(i);
		return this;
	}
};

var init = function init(sel, opts) {
	var els = [].slice.call(document.querySelectorAll(sel));

	if (!els.length) throw new Error('Tab Accordion cannot be initialised, no augmentable elements found');

	return els.map(function (el) {
		return Object.assign(Object.create(StormTabAccordion), {
			DOMElement: el,
			settings: Object.assign({}, defaults, opts)
		}).init();
	});
};

exports.default = { init: init };

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJleGFtcGxlL3NyYy9hcHAuanMiLCJleGFtcGxlL3NyYy9saWJzL3N0b3JtLXRhYi1hY2NvcmRpb24uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBOzs7Ozs7QUFFQSxJQUFNLDBCQUEwQixDQUFDLFlBQU07QUFDdEMsOEJBQWEsSUFBYixDQUFrQixtQkFBbEI7QUFDQSxDQUYrQixDQUFoQzs7QUFJQSxJQUFHLHNCQUFzQixNQUF6QixFQUFpQyxPQUFPLGdCQUFQLENBQXdCLGtCQUF4QixFQUE0QyxZQUFNO0FBQUUsMEJBQXdCLE9BQXhCLENBQWdDLFVBQUMsRUFBRDtBQUFBLFdBQVEsSUFBUjtBQUFBLEdBQWhDO0FBQWdELENBQXBHOzs7Ozs7OztBQ05qQzs7Ozs7Ozs7OztBQVVBLElBQU0sWUFBWTtBQUNoQixRQUFPLEVBRFM7QUFFaEIsUUFBTyxFQUZTO0FBR2hCLE1BQUssQ0FIVztBQUloQixPQUFNLEVBSlU7QUFLaEIsUUFBTyxFQUxTO0FBTWhCLEtBQUcsRUFOYTtBQU9oQixPQUFNO0FBUFUsQ0FBbEI7QUFBQSxJQVNDLFdBQVc7QUFDVixXQUFVLHVCQURBO0FBRVYsYUFBWSx5QkFGRjtBQUdWLGVBQWMsUUFISjtBQUlWLFNBQVEsQ0FKRTtBQUtWLGlCQUFnQjtBQUxOLENBVFo7QUFBQSxJQWdCQyxvQkFBb0I7QUFDbkIsS0FEbUIsa0JBQ1o7QUFBQTs7QUFDTixNQUFJLE9BQU8sU0FBUyxJQUFULENBQWMsS0FBZCxDQUFvQixDQUFwQixLQUEwQixJQUFyQztBQUNBLE9BQUssSUFBTCxHQUFZLEdBQUcsS0FBSCxDQUFTLElBQVQsQ0FBYyxLQUFLLFVBQUwsQ0FBZ0IsZ0JBQWhCLENBQWlDLEtBQUssUUFBTCxDQUFjLFFBQS9DLENBQWQsQ0FBWjtBQUNBLE9BQUssTUFBTCxHQUFjLEdBQUcsS0FBSCxDQUFTLElBQVQsQ0FBYyxLQUFLLFVBQUwsQ0FBZ0Is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ZSxTQUFqQixJQUE4QixPQUFPLE9BQVAsQ0FBZSxTQUFmLENBQXlCLEVBQUUsS0FBSyxLQUFLLElBQUwsQ0FBVSxDQUFWLEVBQWEsWUFBYixDQUEwQixNQUExQixDQUFQLEVBQXpCLEVBQXFFLEVBQXJFLEVBQXlFLEtBQUssSUFBTCxDQUFVLENBQVYsRUFBYSxZQUFiLENBQTBCLE1BQTFCLENBQXpFLENBQTlCO0FBQ0EsTUFBRyxLQUFLLE9BQUwsS0FBaUIsSUFBcEIsRUFBMEI7QUFDekIsUUFBSyxJQUFMLENBQVUsQ0FBVjtBQUNBLFVBQU8sSUFBUDtBQUNBO0FBQ0QsT0FBSyxLQUFMLENBQVcsS0FBSyxPQUFoQixFQUNFLElBREYsQ0FDTyxDQURQO0FBRUEsU0FBTyxJQUFQO0FBQ0E7QUFyTmtCLENBaEJyQjs7QUF3T0EsSUFBTSxPQUFPLFNBQVAsSUFBTyxDQUFDLEdBQUQsRUFBTSxJQUFOLEVBQWU7QUFDM0IsS0FBSSxNQUFNLEdBQUcsS0FBSCxDQUFTLElBQVQsQ0FBYyxTQUFTLGdCQUFULENBQTBCLEdBQTFCLENBQWQsQ0FBVjs7QUFFQSxLQUFHLENBQUMsSUFBSSxNQUFSLEVBQWdCLE1BQU0sSUFBSSxLQUFKLENBQVUsb0VBQVYsQ0FBTjs7QUFFaEIsUUFBTyxJQUFJLEdBQUosQ0FBUSxVQUFDLEVBQUQsRUFBUTtBQUN0QixTQUFPLE9BQU8sTUFBUCxDQUFjLE9BQU8sTUFBUCxDQUFjLGlCQUFkLENBQWQsRUFBZ0Q7QUFDdEQsZUFBWSxFQUQwQztBQUV0RCxhQUFVLE9BQU8sTUFBUCxDQUFjLEVBQWQsRUFBa0IsUUFBbEIsRUFBNEIsSUFBNUI7QUFGNEMsR0FBaEQsRUFHSixJQUhJLEVBQVA7QUFJQSxFQUxNLENBQVA7QUFNQSxDQVhEOztrQkFhZSxFQUFFLFVBQUYsRSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJpbXBvcnQgVGFiQWNjb3JkaW9uIGZyb20gJy4vbGlicy9zdG9ybS10YWItYWNjb3JkaW9uJztcblxuY29uc3Qgb25ET01Db250ZW50TG9hZGVkVGFza3MgPSBbKCkgPT4ge1xuXHRUYWJBY2NvcmRpb24uaW5pdCgnLmpzLXRhYi1hY2NvcmRpb24nKTtcbn1dO1xuICAgIFxuaWYoJ2FkZEV2ZW50TGlzdGVuZXInIGluIHdpbmRvdykgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7IG9uRE9NQ29udGVudExvYWRlZFRhc2tzLmZvckVhY2goKGZuKSA9PiBmbigpKTsgfSk7IiwiLyoqXG4gKiBAbmFtZSBzdG9ybS10YWItYWNjb3JkaW9uOiBUYWIgYW5kIGFjY29yZGlvbiB1aSBjb21wb25lbnQgZm9yIG11bHRpLXBhbmVsbGVkIGNvbnRlbnQgYXJlYXNcbjw8PDw8PDwgSEVBRFxuICogQHZlcnNpb24gMC41LjA6IEZyaSwgMTAgRmViIDIwMTcgMTc6NTI6NTYgR01UXG49PT09PT09XG4gKiBAdmVyc2lvbiAwLjUuMDogVHVlLCAyOCBGZWIgMjAxNyAyMjoxNzowOSBHTVRcbj4+Pj4+Pj4gMjE4ZTExZWNmMDYyNDMyYmVjNmUyYjVmNTNjOGJlYTRiN2IyOTliNlxuICogQGF1dGhvciBtamJwXG4gKiBAbGljZW5zZSBNSVRcbiAqL1xuY29uc3QgS0VZX0NPREVTID0ge1xuXHRcdFNQQUNFOiAzMixcblx0XHRFTlRFUjogMTMsXG5cdFx0VEFCOiA5LFxuXHRcdExFRlQ6IDM3LFxuXHRcdFJJR0hUOiAzOSxcblx0XHRVUDozOCxcblx0XHRET1dOOiA0MFxuXHR9LFxuXHRkZWZhdWx0cyA9IHtcblx0XHR0YWJDbGFzczogJy5qcy10YWItYWNjb3JkaW9uLXRhYicsXG5cdFx0dGl0bGVDbGFzczogJy5qcy10YWItYWNjb3JkaW9uLXRpdGxlJyxcblx0XHRjdXJyZW50Q2xhc3M6ICdhY3RpdmUnLFxuXHRcdGFjdGl2ZTogMCxcblx0XHR0YWJDdXJzb3JFdmVudDogJ2NsaWNrJ1xuXHR9LFxuXHRTdG9ybVRhYkFjY29yZGlvbiA9IHtcblx0XHRpbml0KCkge1xuXHRcdFx0bGV0IGhhc2ggPSBsb2NhdGlvbi5oYXNoLnNsaWNlKDEpIHx8IG51bGw7XG5cdFx0XHR0aGlzLnRhYnMgPSBbXS5zbGljZS5jYWxsKHRoaXMuRE9NRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuc2V0dGluZ3MudGFiQ2xhc3MpKTtcblx0XHRcdHRoaXMudGl0bGVzID0gW10uc2xpY2UuY2FsbCh0aGlzLkRPTUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLnNldHRpbmdzLnRpdGxlQ2xhc3MpKTtcblxuXHRcdFx0dGhpcy50YXJnZXRzID0gdGhpcy50YWJzLm1hcChlbCA9PiB7XG5cdFx0XHRcdHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKS5zdWJzdHIoMSkpIHx8IGNvbnNvbGUuZXJyb3IoJ1RhYiB0YXJnZXQgbm90IGZvdW5kJyk7XG5cdFx0XHR9KTtcblx0XHRcdFx0XG5cdFx0XHR0aGlzLmN1cnJlbnQgPSB0aGlzLnNldHRpbmdzLmFjdGl2ZTtcblx0XHRcdGlmIChoYXNoKSB7XG5cdFx0XHRcdHRoaXMudGFyZ2V0cy5mb3JFYWNoKCh0YXJnZXQsIGkpID0+IHtcblx0XHRcdFx0XHRpZiAodGFyZ2V0LmdldEF0dHJpYnV0ZSgnaWQnKSA9PT0gaGFzaCkge1xuXHRcdFx0XHRcdFx0dGhpcy5jdXJyZW50ID0gaTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5pbml0QXJpYSgpO1xuXHRcdFx0dGhpcy5pbml0VGl0bGVzKCk7XG5cdFx0XHR0aGlzLmluaXRUYWJzKCk7XG5cdFx0XHR0aGlzLm9wZW4odGhpcy5jdXJyZW50KTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRpbml0QXJpYSgpIHtcblx0XHRcdHRoaXMudGFicy5mb3JFYWNoKGVsID0+IHtcblx0XHRcdFx0ZWwuc2V0QXR0cmlidXRlKCdyb2xlJywgJ3RhYicpO1xuXHRcdFx0XHRlbC5zZXRBdHRyaWJ1dGUoJ3RhYkluZGV4JywgMCk7XG5cdFx0XHRcdGVsLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsIGZhbHNlKTtcblx0XHRcdFx0ZWwuc2V0QXR0cmlidXRlKCdhcmlhLXNlbGVjdGVkJywgZmFsc2UpO1xuXHRcdFx0XHRlbC5zZXRBdHRyaWJ1dGUoJ2FyaWEtY29udHJvbHMnLCBlbC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSA/IGVsLmdldEF0dHJpYnV0ZSgnaHJlZicpLnN1YnN0cigxKSA6IGVsLnBhcmVudE5vZGUuZ2V0QXR0cmlidXRlKCdpZCcpKTtcblxuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLnRhcmdldHMuZm9yRWFjaChlbCA9PiB7XG5cdFx0XHRcdGVsLnNldEF0dHJpYnV0ZSgncm9sZScsICd0YWJwYW5lbCcpO1xuXHRcdFx0XHRlbC5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgdHJ1ZSk7XG5cdFx0XHRcdGVsLnNldEF0dHJpYnV0ZSgndGFiSW5kZXgnLCAnLTEnKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRpbml0VGl0bGVzKCkge1xuXHRcdFx0bGV0IGhhbmRsZXIgPSBpID0+IHtcblx0XHRcdFx0dGhpcy50b2dnbGUoaSk7XG5cdFx0XHR9O1xuXG5cdFx0XHR0aGlzLnRpdGxlcy5mb3JFYWNoKChlbCwgaSkgPT4ge1xuXHRcdFx0XHRlbC5hZGRFdmVudExpc3RlbmVyKHRoaXMuc2V0dGluZ3MudGFiQ3Vyc29yRXZlbnQsIGUgPT4ge1xuXHRcdFx0XHRcdGlmKCEhZS5rZXlDb2RlICYmIGUua2V5Q29kZSA9PT0gS0VZX0NPREVTLlRBQikgcmV0dXJuO1xuXG5cdFx0XHRcdFx0aWYoIWUua2V5Q29kZSB8fCBlLmtleUNvZGUgPT09IEtFWV9DT0RFUy5FTlRFUil7XG5cdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRoYW5kbGVyLmNhbGwodGhpcywgaSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LCBmYWxzZSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRpbml0VGFicygpIHtcblx0XHRcdGxldCBoYW5kbGVyID0gaSA9PiB7XG5cdFx0XHRcdHRoaXMudG9nZ2xlKGkpO1xuXHRcdFx0fTtcblxuXHRcdFx0dGhpcy5sYXN0Rm9jdXNlZFRhYiA9IDA7XG5cblx0XHRcdHRoaXMudGFicy5mb3JFYWNoKChlbCwgaSkgPT4ge1xuXHRcdFx0XHQvL25hdmlnYXRlXG5cdFx0XHRcdGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBlID0+IHtcblx0XHRcdFx0XHRzd2l0Y2ggKGUua2V5Q29kZSkge1xuXHRcdFx0XHRcdGNhc2UgS0VZX0NPREVTLlVQOlxuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0dGhpcy50b2dnbGUoKHRoaXMuY3VycmVudCA9PT0gMCA/IHRoaXMudGFicy5sZW5ndGggLSAxIDogdGhpcy5jdXJyZW50IC0gMSkpO1xuXHRcdFx0XHRcdFx0d2luZG93LnNldFRpbWVvdXQoKCkgPT4geyB0aGlzLnRhYnNbdGhpcy5jdXJyZW50XS5mb2N1cygpOyB9LCAxNik7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlIEtFWV9DT0RFUy5MRUZUOlxuXHRcdFx0XHRcdFx0dGhpcy50b2dnbGUoKHRoaXMuY3VycmVudCA9PT0gMCA/IHRoaXMudGFicy5sZW5ndGggLSAxIDogdGhpcy5jdXJyZW50IC0gMSkpO1xuXHRcdFx0XHRcdFx0d2luZG93LnNldFRpbWVvdXQoKCkgPT4geyB0aGlzLnRhYnNbdGhpcy5jdXJyZW50XS5mb2N1cygpOyB9LCAxNik7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlIEtFWV9DT0RFUy5ET1dOOlxuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0dGhpcy50b2dnbGUoKHRoaXMuY3VycmVudCA9PT0gdGhpcy50YWJzLmxlbmd0aCAtIDEgPyAwIDogdGhpcy5jdXJyZW50ICsgMSkpO1xuXHRcdFx0XHRcdFx0d2luZG93LnNldFRpbWVvdXQoKCkgPT4geyB0aGlzLnRhYnNbdGhpcy5jdXJyZW50XS5mb2N1cygpOyB9LCAxNik7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlIEtFWV9DT0RFUy5SSUdIVDpcblx0XHRcdFx0XHRcdHRoaXMudG9nZ2xlKCh0aGlzLmN1cnJlbnQgPT09IHRoaXMudGFicy5sZW5ndGggLSAxID8gMCA6IHRoaXMuY3VycmVudCArIDEpKTtcblx0XHRcdFx0XHRcdHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHsgdGhpcy50YWJzW3RoaXMuY3VycmVudF0uZm9jdXMoKTsgfSwgMTYpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0Y2FzZSBLRVlfQ09ERVMuRU5URVI6XG5cdFx0XHRcdFx0XHRoYW5kbGVyLmNhbGwodGhpcywgaSk7ICBcblx0XHRcdFx0XHRcdHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHsgdGhpcy50YWJzW2ldLmZvY3VzKCk7IH0sIDE2KTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdGNhc2UgS0VZX0NPREVTLlNQQUNFOlxuXHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0dGhpcy50b2dnbGUoaSk7XG5cdFx0XHRcdFx0XHR3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7IHRoaXMudGFic1tpXS5mb2N1cygpOyB9LCAxNik7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlIEtFWV9DT0RFUy5UQUI6XG5cdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdFx0dGhpcy5sYXN0Rm9jdXNlZFRhYiA9IHRoaXMuZ2V0VGFiSW5kZXgoZS50YXJnZXQpO1xuXHRcdFx0XHRcdFx0dGhpcy5zZXRUYXJnZXRGb2N1cyh0aGlzLmxhc3RGb2N1c2VkVGFiKTtcblx0XHRcdFx0XHRcdGhhbmRsZXIuY2FsbCh0aGlzLCBpKTtcblx0XHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHRcdC8vXG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdC8vdG9nZ2xlXG5cdFx0XHRcdGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdGhhbmRsZXIuY2FsbCh0aGlzLCBpKTsgIFxuXHRcdFx0XHR9LCBmYWxzZSk7XG5cdFx0XHR9KTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRnZXRUYWJJbmRleChsaW5rKXtcblx0XHRcdGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLnRhYnMubGVuZ3RoOyBpKyspe1xuXHRcdFx0XHRpZihsaW5rID09PSB0aGlzLnRhYnNbaV0pIHJldHVybiBpO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fSxcblx0XHRnZXRGb2N1c2FibGVDaGlsZHJlbihub2RlKSB7XG5cdFx0XHRsZXQgZm9jdXNhYmxlRWxlbWVudHMgPSBbJ2FbaHJlZl0nLCAnYXJlYVtocmVmXScsICdpbnB1dDpub3QoW2Rpc2FibGVkXSknLCAnc2VsZWN0Om5vdChbZGlzYWJsZWRdKScsICd0ZXh0YXJlYTpub3QoW2Rpc2FibGVkXSknLCAnYnV0dG9uOm5vdChbZGlzYWJsZWRdKScsICdpZnJhbWUnLCAnb2JqZWN0JywgJ2VtYmVkJywgJ1tjb250ZW50ZWRpdGFibGVdJywgJ1t0YWJJbmRleF06bm90KFt0YWJJbmRleD1cIi0xXCJdKSddO1xuXHRcdFx0cmV0dXJuIFtdLnNsaWNlLmNhbGwobm9kZS5xdWVyeVNlbGVjdG9yQWxsKGZvY3VzYWJsZUVsZW1lbnRzLmpvaW4oJywnKSkpO1xuXHRcdH0sXG5cdFx0c2V0VGFyZ2V0Rm9jdXModGFiSW5kZXgpe1xuXHRcdFx0dGhpcy5mb2N1c2FibGVDaGlsZHJlbiA9IHRoaXMuZ2V0Rm9jdXNhYmxlQ2hpbGRyZW4odGhpcy50YXJnZXRzW3RhYkluZGV4XSk7XG5cdFx0XHRcblx0XHRcdGlmKHRoaXMuZm9jdXNhYmxlQ2hpbGRyZW4ubGVuZ3RoKXtcblx0XHRcdFx0d2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKXtcblx0XHRcdFx0XHR0aGlzLmZvY3VzYWJsZUNoaWxkcmVuWzBdLmZvY3VzKCk7XG5cdFx0XHRcdFx0dGhpcy5rZXlFdmVudExpc3RlbmVyID0gdGhpcy5rZXlMaXN0ZW5lci5iaW5kKHRoaXMpO1xuXHRcdFx0XHRcdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmtleUV2ZW50TGlzdGVuZXIpO1xuXHRcdFx0XHR9LmJpbmQodGhpcyksIDApO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0a2V5TGlzdGVuZXIoZSl7XG5cdFx0XHRpZiAoZS5rZXlDb2RlICE9PSBLRVlfQ09ERVMuVEFCKSByZXR1cm47XG5cdFx0XHRcblx0XHRcdGxldCBmb2N1c2VkSW5kZXggPSB0aGlzLmZvY3VzYWJsZUNoaWxkcmVuLmluZGV4T2YoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCk7XG5cdFx0XHRcblx0XHRcdGlmKGZvY3VzZWRJbmRleCA8IDApIHtcblx0XHRcdFx0ZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMua2V5RXZlbnRMaXN0ZW5lcik7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdFxuXHRcdFx0aWYoZS5zaGlmdEtleSAmJiBmb2N1c2VkSW5kZXggPT09IDApIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR0aGlzLmZvY3VzYWJsZUNoaWxkcmVuW3RoaXMuZm9jdXNhYmxlQ2hpbGRyZW4ubGVuZ3RoIC0gMV0uZm9jdXMoKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmKCFlLnNoaWZ0S2V5ICYmIGZvY3VzZWRJbmRleCA9PT0gdGhpcy5mb2N1c2FibGVDaGlsZHJlbi5sZW5ndGggLSAxKSB7XG5cdFx0XHRcdFx0ZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMua2V5RXZlbnRMaXN0ZW5lcik7XG5cdFx0XHRcdFx0aWYodGhpcy5sYXN0Rm9jdXNlZFRhYiAhPT0gdGhpcy50YWJzLmxlbmd0aCAtIDEpIHtcblx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdHRoaXMubGFzdEZvY3VzZWRUYWIgPSB0aGlzLmxhc3RGb2N1c2VkVGFiICsgMTtcblx0XHRcdFx0XHRcdHRoaXMudGFic1t0aGlzLmxhc3RGb2N1c2VkVGFiXS5mb2N1cygpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cdFx0Y2hhbmdlKHR5cGUsIGkpIHtcblx0XHRcdGxldCBtZXRob2RzID0ge1xuXHRcdFx0XHRvcGVuOiB7XG5cdFx0XHRcdFx0Y2xhc3NsaXN0OiAnYWRkJyxcblx0XHRcdFx0XHR0YWJJbmRleDoge1xuXHRcdFx0XHRcdFx0dGFyZ2V0OiB0aGlzLnRhcmdldHNbaV0sXG5cdFx0XHRcdFx0XHR2YWx1ZTogJzAnXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LFxuXHRcdFx0XHRjbG9zZToge1xuXHRcdFx0XHRcdGNsYXNzbGlzdDogJ3JlbW92ZScsXG5cdFx0XHRcdFx0dGFiSW5kZXg6IHtcblx0XHRcdFx0XHRcdHRhcmdldDogdGhpcy50YXJnZXRzW3RoaXMuY3VycmVudF0sXG5cdFx0XHRcdFx0XHR2YWx1ZTogJy0xJ1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fTtcblxuXHRcdFx0dGhpcy50YWJzW2ldLmNsYXNzTGlzdFttZXRob2RzW3R5cGVdLmNsYXNzbGlzdF0odGhpcy5zZXR0aW5ncy5jdXJyZW50Q2xhc3MpO1xuXHRcdFx0dGhpcy50aXRsZXNbaV0uY2xhc3NMaXN0W21ldGhvZHNbdHlwZV0uY2xhc3NsaXN0XSh0aGlzLnNldHRpbmdzLmN1cnJlbnRDbGFzcyk7XG5cdFx0XHR0aGlzLnRhcmdldHNbaV0uY2xhc3NMaXN0W21ldGhvZHNbdHlwZV0uY2xhc3NsaXN0XSh0aGlzLnNldHRpbmdzLmN1cnJlbnRDbGFzcyk7XG5cblx0XHRcdHRoaXMudGFyZ2V0c1tpXS5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgdGhpcy50YXJnZXRzW2ldLmdldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nKSA9PT0gJ3RydWUnID8gJ2ZhbHNlJyA6ICd0cnVlJyk7XG5cdFx0XHR0aGlzLnRhYnNbaV0uc2V0QXR0cmlidXRlKCdhcmlhLXNlbGVjdGVkJywgdGhpcy50YWJzW2ldLmdldEF0dHJpYnV0ZSgnYXJpYS1zZWxlY3RlZCcpID09PSAndHJ1ZScgPyAnZmFsc2UnIDogJ3RydWUnKTtcblx0XHRcdHRoaXMudGFic1tpXS5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCB0aGlzLnRhYnNbaV0uZ2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJykgPT09ICd0cnVlJyA/ICdmYWxzZScgOiAndHJ1ZScpO1xuXHRcdFx0bWV0aG9kc1t0eXBlXS50YWJJbmRleC50YXJnZXQuc2V0QXR0cmlidXRlKCd0YWJJbmRleCcsIG1ldGhvZHNbdHlwZV0udGFiSW5kZXgudmFsdWUpO1xuXHRcdFx0XG5cdFx0fSxcblx0XHRvcGVuKGkpIHtcblx0XHRcdHRoaXMuY2hhbmdlKCdvcGVuJywgaSk7XG5cdFx0XHR0aGlzLmN1cnJlbnQgPSBpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRjbG9zZShpKSB7XG5cdFx0XHR0aGlzLmNoYW5nZSgnY2xvc2UnLCBpKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0dG9nZ2xlKGkpIHtcblx0XHRcdGlmKHRoaXMuY3VycmVudCA9PT0gaSkgeyByZXR1cm47IH1cblx0XHRcdFxuXHRcdFx0ISF3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUgJiYgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKHsgVVJMOiB0aGlzLnRhYnNbaV0uZ2V0QXR0cmlidXRlKCdocmVmJykgfSwgJycsIHRoaXMudGFic1tpXS5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSk7XG5cdFx0XHRpZih0aGlzLmN1cnJlbnQgPT09IG51bGwpIHsgXG5cdFx0XHRcdHRoaXMub3BlbihpKTtcblx0XHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLmNsb3NlKHRoaXMuY3VycmVudClcblx0XHRcdFx0Lm9wZW4oaSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cdH07XG5cbmNvbnN0IGluaXQgPSAoc2VsLCBvcHRzKSA9PiB7XG5cdGxldCBlbHMgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsKSk7XG5cdFxuXHRpZighZWxzLmxlbmd0aCkgdGhyb3cgbmV3IEVycm9yKCdUYWIgQWNjb3JkaW9uIGNhbm5vdCBiZSBpbml0aWFsaXNlZCwgbm8gYXVnbWVudGFibGUgZWxlbWVudHMgZm91bmQnKTtcblxuXHRyZXR1cm4gZWxzLm1hcCgoZWwpID0+IHtcblx0XHRyZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuY3JlYXRlKFN0b3JtVGFiQWNjb3JkaW9uKSwge1xuXHRcdFx0RE9NRWxlbWVudDogZWwsXG5cdFx0XHRzZXR0aW5nczogT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdHMsIG9wdHMpXG5cdFx0fSkuaW5pdCgpO1xuXHR9KTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHsgaW5pdCB9OyJdfQ==
